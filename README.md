# RealRandomNomberGenerator

A lottery wheel application that generates truly random numbers using microphone input as an entropy source. Built with Python FastAPI backend and Astro + React frontend.

## Quick Start

```bash
# Install dependencies
pip install -r requirements.txt

# Start backend
python src/server.py
# Backend runs on http://127.0.0.1:8000

# In another terminal, start frontend
cd lottery-wheel
npm install && npm run dev
# Frontend runs on http://localhost:4321
```

## Installation

### Prerequisites

- **Python 3.x** (tested with Python 3.13)
- **Node.js and npm** (for frontend)
- **System audio libraries** (for PyAudio)

#### Install System Dependencies

**Ubuntu/Debian:**
```bash
sudo apt-get update
sudo apt-get install python3-dev portaudio19-dev
```

**Fedora:**
```bash
sudo dnf install python3-devel portaudio-devel
```

**macOS (via Homebrew):**
```bash
brew install portaudio
```

### Install Python Dependencies

```bash
pip install -r requirements.txt
```

### Install Frontend Dependencies

```bash
cd lottery-wheel
npm install
```

## Usage

### Backend API Server

Start the FastAPI server:
```bash
python src/server.py
```

The server provides:
- **API endpoint:** `http://127.0.0.1:8000/api/random`
- **API docs:** `http://127.0.0.1:8000/docs` (auto-generated by FastAPI)

#### API Response Format
```json
{
  "rand": 0.123456,
  "source": "microphone",
  "timestamp": "2024-01-01T12:00:00"
}
```

- `rand`: Random float between 0 and 1
- `source`: Either "microphone" or "fallback"
- `timestamp`: ISO format timestamp

### Frontend Application

```bash
cd lottery-wheel
npm run dev           # Development server (http://localhost:4321)
npm run build         # Build for production
npm run preview       # Preview production build
```

### Utility Commands

#### List Available Audio Devices
```bash
python src/RealRNG/RealRNG.py --list-devices
```

#### Check CLI Help
```bash
python src/RealRNG/RealRNG.py --help
```

## Testing

### Run All Tests
```bash
python -m unittest discover tests
```

### Run Specific Test File
```bash
python tests/test_device_selection.py
python tests/test_api_variance.py
```

### Test with Debug Logging
```bash
REALRNG_DEBUG=1 python tests/test_device_selection.py
```

**Testing Framework:** This project uses Python's built-in `unittest` framework for simplicity and zero additional dependencies.

## Configuration

### Manual Audio Device Selection

By default, the system auto-detects and selects an audio device with actual input variance. To manually specify a device:

```bash
# List devices first
python src/RealRNG/RealRNG.py --list-devices

# Use specific device (e.g., device 6)
REALRNG_DEVICE_INDEX=6 python src/server.py
```

### Enable Debug Logging

```bash
# For server
REALRNG_DEBUG=1 python src/server.py

# For tests
REALRNG_DEBUG=1 python -m unittest discover tests
```

## Architecture

### Backend (Python + FastAPI)

- **Location:** `src/`
- **Entry point:** `src/server.py`
- **RNG Library:** `src/RealRNG/RealRNG.py`

The `RealRNG` class generates random numbers by:
1. Capturing microphone audio input using PyAudio
2. Hashing the audio data with SHA-256
3. Converting the hash to a float in range [0, 1)

If microphone access fails, it falls back to Python's standard `random` module.

### Frontend (Astro + React)

- **Location:** `lottery-wheel/`
- **Main page:** `lottery-wheel/src/pages/index.astro`
- **Interactive component:** `lottery-wheel/src/components/SpinWheel.jsx`

The SpinWheel component:
- Renders a spinning wheel with user-provided options
- Fetches random numbers from the backend API
- Falls back to `Math.random()` if API is unavailable
- Animates the spinning and winner selection

## How It Works

### True Random Number Generation

1. **Audio Capture:** Reads a small sample of microphone input
2. **Entropy Extraction:** Uses SHA-256 hash of audio data
3. **Device Selection:** Auto-detects devices with actual audio variance (not silent/muted devices)
4. **Fallback:** Uses Python's `random` module if microphone unavailable

### Device Selection Logic

The system tests each audio device by:
1. Capturing 3 audio samples
2. Validating that samples contain variance (not all zeros or identical)
3. Selecting the first device that passes validation
4. Rejecting devices that only produce silence

This prevents the bug where a muted/inactive microphone would produce the same "random" number every time.

## Troubleshooting

### All Random Numbers Are The Same

If you're getting identical random numbers:
1. Check which audio device is selected (look at server startup logs)
2. List available devices: `python src/RealRNG/RealRNG.py --list-devices`
3. Manually select a different device: `REALRNG_DEVICE_INDEX=6 python src/server.py`
4. Ensure microphone permissions are granted to the application

### Microphone Not Detected

- On first run, check system settings to grant microphone permissions
- Try running with debug logging: `REALRNG_DEBUG=1 python src/server.py`
- The system will fall back to Python's `random` module if no microphone is available

## Developer Documentation

For detailed developer documentation, architecture details, and contribution guidelines, see [CLAUDE.md](./CLAUDE.md).
